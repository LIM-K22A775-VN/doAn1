<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang quản trị</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .container {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
        }

        .container h2 {
            color: #333;
            text-align: center;
            font-size: 24px;
        }

        .filter-bar {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .filter-bar label {
            font-weight: 600;
            align-self: center;
        }

        .filter-bar input,
        .filter-bar select {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
            width: 200px;
        }

        .booking-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 0 20px;
            max-height: 70vh;
            /* hoặc height: 500px; */
            overflow-y: auto;
            padding-right: 10px;
            /* tránh che nội dung bởi scrollbar */
            padding-bottom: 40px;
        }

        .booking-card {
            background: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .booking-card:hover {
            transform: translateY(-2px);
        }

        .booking-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .booking-info h3 {
            margin: 0;
            color: #007bff;
            font-size: 18px;
        }

        .booking-info p {
            margin: 0;
            font-size: 14px;
            color: #444;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-tag {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-reserved {
            background: #ffc107;
            color: #000;
        }

        .status-paid {
            background: #28a745;
            color: #fff;
        }

        .status-cancelled {
            background: #dc3545;
            color: #fff;
        }

        .choose-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            align-self: flex-start;
        }

        .choose-btn:hover {
            background: #0056b3;

        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='CssTotal/sidebar_staff.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='CssTotal/navbar_admin.css') }}">
</head>

<body>
    {% include "partials/sidebar_staff.html" %}
    <div class="main" id="main">
        {% include "partials/navbar_staff.html" %}
        <div class="inner-position">
            <h2>Xử lý đặt bàn</h2>
            <div class="position-right">
                <a href="intro.html">Trang chủ /</a>
                <p>Đơn đặt bàn</p>
            </div>
        </div>
        <div class="container">
            <h2>Danh sách đặt bàn</h2>

            <!-- Bộ lọc -->
            <form class="filter-bar">
                <label for="statusFilter">Lọc theo:</label>
                <input style="background-color: #f0f0f0;" type="text" id="nameFilter" placeholder="Tìm theo tên..."
                    oninput="filterBookings()" />
                <select style="background-color: #f0f0f0;" id="statusFilter" onchange="filterBookings()">
                    <option value="all">Tất cả</option>
                    <option value="reserved">Đã đặt bàn</option>
                    <option value="paid">Đã thanh toán</option>
                    <option value="cancelled">Đã hủy</option>
                </select>
            </form>

            <!-- Danh sách đơn -->
            <!-- Danh sách đơn -->
            <div class="booking-container" id="bookingList">
                {% for item in reservations %}
                <div class="booking-card"
                    data-status="{% if item.booking_status == 'Đã đặt' %}reserved{% elif item.booking_status == 'Đã thanh toán' %}paid{% elif item.booking_status == 'Đã hủy' %}cancelled{% else %}other{% endif %}"
                    data-name="{{ item.userName }}">


                    <div class="booking-info">
                        <h3>mã đơn tại bàn:{{item.IdTable}}</h3>
                        <h3>{{ item.userName }}</h3>
                        <p><strong>Điện thoại:</strong> {{ item.phone }}</p>
                        <p><strong>Email:</strong> {{ item.Email }}</p>
                        <p><strong>Ngày đặt:</strong>
                            {{ item.createdAt.strftime("%d/%m/%Y") if item.createdAt else "" }}</p>
                        <p><strong>Thời gian:</strong> {{ item.time }}</p>
                        <p><strong>Số người:</strong> {{ item.number }}</p>
                        <p><strong>Ghi chú:</strong> {{ item.notes }}</p>
                        <p><strong>Trạng thái bàn:</strong>
                            <span class="status-tag">{{ item.table_status }}</span>
                        </p>

                        <p><strong>Trạng thái đơn:</strong>
                            {% if item.booking_status == 'Đã đặt' %}
                            <span class="status-tag status-reserved">Đã đặt bàn</span>
                            {% elif item.booking_status == 'Đã thanh toán' %}
                            <span class="status-tag status-paid">Đã thanh toán</span>
                            {% elif item.booking_status == 'Đã hủy' %}
                            <span class="status-tag status-cancelled">Đã hủy</span>
                            {% else %}
                            <span class="status-tag">{{ item.booking_status }}</span>
                            {% endif %}
                        </p>

                        <p></p>
                    </div>
                    <button class="choose-btn"
                        onclick="window.location.href = '/staff_order?bookingId={{ item.IdTable }}'">
                        <i class="fa fa-utensils"></i> Chọn món
                    </button>
                </div>
                {% endfor %}
            </div>

        </div>
    </div>
    <script>
        $(document).ready(function () {
            $("#sidebar").load("sidebar_staff.html?v=" + Math.random(), function (response, status, xhr) {
                if (status == "error") {
                    console.error("Lỗi khi tải sidebar_staff.html: " + xhr.status + " " + xhr
                        .statusText);
                }
            });
            $("#navbar").load("navbar_staff.html?v=" + Math.random(), function (response, status, xhr) {
                if (status == "error") {
                    console.error("Lỗi khi tải navbar_staff.html: " + xhr.status + " " + xhr
                        .statusText);
                } else {
                    $.getScript("CssTotal/navbar_admin.js");
                }
            });
        });

        function filterBookings() {
            const selectedStatus = document.getElementById("statusFilter").value.toLowerCase();
            const searchName = document.getElementById("nameFilter").value.toLowerCase().trim();
            const cards = document.querySelectorAll(".booking-card");

            cards.forEach(card => {
                const cardStatus = card.getAttribute("data-status").toLowerCase();
                const cardName = card.getAttribute("data-name").toLowerCase();

                const statusMatch = selectedStatus === "all" || cardStatus === selectedStatus;
                const nameMatch = cardName.includes(searchName);

                card.style.display = (statusMatch && nameMatch) ? "flex" : "none";
            });
        }
    </script>

    <!-- ✅ JavaScript để điều khiển dropdown: -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const userInfo = document.getElementById("userInfo");
            const userDropdown = document.getElementById("userDropdown");

            // Mặc định ẩn dropdown
            if (userDropdown) userDropdown.style.display = "none";

            // Toggle dropdown khi click vào userInfo
            if (userInfo) {
                userInfo.addEventListener("click", function (e) {
                    e.stopPropagation(); // Ngăn chặn sự kiện lan ra ngoài
                    if (userDropdown.style.display === "block") {
                        userDropdown.style.display = "none";
                    } else {
                        userDropdown.style.display = "block";
                    }
                });
            }

            // Ẩn dropdown khi click ra ngoài
            window.addEventListener("click", function (e) {
                if (!userInfo.contains(e.target)) {
                    userDropdown.style.display = "none";
                }
            });

            // phóng to
            const fullscreenBtn = document.getElementById("fullscreenBtn");
            fullscreenBtn.addEventListener("click", () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            });

        });
    </script>
</body>

</html>